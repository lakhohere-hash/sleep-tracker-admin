<!-- PROFESSIONAL SUBSCRIPTIONS - REVENUE OPTIMIZATION ENGINE -->
<div class="professional-subscriptions">
  <!-- Professional Header -->
  <header class="subscriptions-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <i class="icon-diamond"></i>
          Subscription Management
          <span class="pro-badge">Revenue Engine</span>
        </h1>
        <p class="page-subtitle">Manage subscription plans and optimize revenue streams</p>
      </div>
      
      <!-- Revenue Stats -->
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-icon-container">
            <i class="icon-revenue"></i>
          </div>
          <div class="stat-content">
            <div class="stat-number">${{ getTotalRevenue() | number:'1.0-0' }}</div>
            <div class="stat-label">Monthly Revenue</div>
            <div class="stat-trend positive">+28.3% growth</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon-container">
            <i class="icon-users"></i>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ getTotalUsers() | number }}</div>
            <div class="stat-label">Active Users</div>
            <div class="stat-trend positive">+12.5% growth</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon-container">
            <i class="icon-trial"></i>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ getTrialUsersCount() }}</div>
            <div class="stat-label">Trial Users</div>
            <div class="stat-trend">{{ getAverageConversionRate() }}% conversion</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon-container">
            <i class="icon-churn"></i>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ churnRate }}%</div>
            <div class="stat-label">Churn Rate</div>
            <div class="stat-trend positive">-12.8% improved</div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Quick Actions Bar -->
  <div class="quick-actions">
    <div class="actions-bar">
      <button class="quick-action-btn create-plan-btn" (click)="createNewPlan()">
        <i class="icon-create"></i>
        Create New Plan
      </button>
      
      <button class="quick-action-btn forecast-btn" (click)="showRevenueForecast()">
        <i class="icon-forecast"></i>
        Revenue Forecast
      </button>
      
      <button class="quick-action-btn optimize-btn" (click)="optimizePricingStrategy()">
        <i class="icon-optimize"></i>
        Optimize Pricing
      </button>
      
      <button class="quick-action-btn churn-btn" (click)="runChurnAnalysis()">
        <i class="icon-churn"></i>
        Churn Analysis
      </button>
      
      <button class="quick-action-btn campaign-btn" (click)="launchPromotionalCampaign()">
        <i class="icon-campaign"></i>
        Launch Campaign
      </button>
      
      <button class="quick-action-btn export-btn" (click)="exportRevenueReport()">
        <i class="icon-export"></i>
        Export Report
      </button>
    </div>
  </div>

  <!-- Plans Section -->
  <section class="plans-section">
    <div class="section-header">
      <h2>Subscription Plans</h2>
      <p>Manage your revenue-generating subscription tiers</p>
    </div>
    
    <div class="plans-grid">
      <div *ngFor="let plan of plans" class="plan-card" [class]="plan.type" [class.featured]="plan.popular">
        <div *ngIf="plan.popular" class="plan-banner">Most Popular</div>
        
        <div class="plan-header">
          <div class="plan-icon">
            <i class="icon-plan" [class.free]="plan.type === 'free'" 
                              [class.premium]="plan.type === 'premium'"
                              [class.enterprise]="plan.type === 'enterprise'"></i>
          </div>
          <h3 class="plan-name">{{ plan.name }}</h3>
          <span class="plan-badge">{{ plan.type }}</span>
        </div>
        
        <div class="plan-price">
          <span class="price-amount">${{ plan.price }}</span>
          <span class="price-period">/{{ plan.interval }}</span>
        </div>
        
        <p class="plan-description">{{ plan.description }}</p>
        
        <div class="plan-features">
          <div *ngFor="let feature of plan.features" class="feature-item">
            <i class="icon-check"></i> {{ feature }}
          </div>
        </div>
        
        <div class="plan-stats">
          <div class="stat">
            <span class="stat-value">{{ plan.activeUsers | number }}</span>
            <span class="stat-label">Users</span>
          </div>
          <div class="stat">
            <span class="stat-value">${{ plan.monthlyRevenue | number }}</span>
            <span class="stat-label">Revenue</span>
          </div>
          <div class="stat">
            <span class="stat-value">{{ plan.conversionRate }}%</span>
            <span class="stat-label">Conversion</span>
          </div>
        </div>
        
        <div class="plan-actions">
          <button class="btn-action btn-edit" (click)="editPlan(plan)">
            <i class="icon-edit"></i>
            Edit
          </button>
          <button class="btn-action btn-analytics" (click)="viewPlanAnalytics(plan)">
            <i class="icon-analytics"></i>
            Analytics
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Subscriptions Table Section -->
  <section class="subscriptions-table-section">
    <div class="section-header">
      <h2>Active Subscriptions</h2>
      <p>Manage your revenue-generating user base</p>
      
      <div class="table-controls">
        <div class="search-container">
          <div class="search-box">
            <i class="icon-search"></i>
            <input type="text" 
                   [(ngModel)]="searchTerm" 
                   (input)="applyFilters()"
                   placeholder="Search users..." 
                   class="search-input">
          </div>
        </div>
        
        <div class="filter-controls">
          <div class="filter-group">
            <label class="filter-label">Status</label>
            <select [(ngModel)]="selectedStatus" (change)="applyFilters()" class="filter-select">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="canceled">Canceled</option>
              <option value="past_due">Past Due</option>
              <option value="trialing">Trialing</option>
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label">Plan</label>
            <select [(ngModel)]="selectedPlan" (change)="applyFilters()" class="filter-select">
              <option value="all">All Plans</option>
              <option value="Free Forever">Free</option>
              <option value="Sleep Pro">Pro</option>
              <option value="Enterprise Suite">Enterprise</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="table-wrapper">
      <table class="subscriptions-table">
        <thead>
          <tr>
            <th>User</th>
            <th>Plan</th>
            <th>Status</th>
            <th>Billing</th>
            <th>Revenue</th>
            <th>Next Bill</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let subscription of getPaginatedSubscriptions()" class="subscription-row">
            <td class="user-cell">
              <div class="user-avatar">
                {{ subscription.userName.charAt(0) }}
              </div>
              <div class="user-info">
                <div class="user-name">{{ subscription.userName }}</div>
                <div class="user-email">{{ subscription.userEmail }}</div>
              </div>
            </td>
            
            <td class="plan-cell">
              <span class="plan-badge" [class]="getPlanClass(subscription.planName)">
                {{ getPlanDisplayName(subscription.planName) }}
              </span>
            </td>
            
            <td class="status-cell">
              <span class="status-badge" [class]="getStatusClass(subscription.status)">
                {{ getStatusDisplayName(subscription.status) }}
              </span>
            </td>
            
            <td class="billing-cell">
              <div class="billing-amount">${{ subscription.amount }}</div>
              <div class="billing-cycle">monthly</div>
            </td>
            
            <td class="revenue-cell">
              <div class="revenue-amount">${{ subscription.amount * 12 | number:'1.0-0' }}</div>
              <div class="revenue-period">annual</div>
            </td>
            
            <td class="next-bill-cell">
              <div class="next-bill-date">{{ subscription.currentPeriodEnd }}</div>
              <div class="days-until" [class.urgent]="isUrgent(subscription.currentPeriodEnd)">
                {{ getDaysUntil(subscription.currentPeriodEnd) }}
              </div>
            </td>
            
            <td class="actions-cell">
              <div class="action-buttons">
                <button class="btn-action btn-manage" (click)="manageSubscription(subscription)">
                  <i class="icon-manage"></i>
                </button>
                <button class="btn-action btn-upgrade" (click)="upgradeUserPlan(subscription)">
                  <i class="icon-upgrade"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="filteredSubscriptions.length > itemsPerPage">
      <div class="pagination-info">
        Showing {{ getCurrentPageStart() }}-{{ getCurrentPageEnd() }} of {{ filteredSubscriptions.length }} subscriptions
      </div>
      
      <div class="pagination-controls">
        <button class="pagination-btn" [disabled]="currentPage === 1" (click)="goToPage(1)">
          <i class="icon-first"></i>
        </button>
        <button class="pagination-btn" [disabled]="currentPage === 1" (click)="previousPage()">
          <i class="icon-prev"></i>
        </button>
        
        <div class="page-numbers">
          <button 
            *ngFor="let page of getVisiblePages()" 
            [class.active]="page === currentPage"
            (click)="goToPage(page)" 
            [disabled]="page === -1"
            class="page-btn">
            {{ page === -1 ? '...' : page }}
          </button>
        </div>
        
        <button class="pagination-btn" [disabled]="currentPage === getTotalPages()" (click)="nextPage()">
          <i class="icon-next"></i>
        </button>
        <button class="pagination-btn" [disabled]="currentPage === getTotalPages()" (click)="goToPage(getTotalPages())">
          <i class="icon-last"></i>
        </button>
      </div>

      <div class="page-size">
        <select #pageSizeSelect (change)="changePageSize(pageSizeSelect.value)" class="page-size-select">
          <option value="10">10 per page</option>
          <option value="25">25 per page</option>
          <option value="50">50 per page</option>
        </select>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredSubscriptions.length === 0 && !isLoading" class="empty-state">
      <div class="empty-icon">
        <i class="icon-subscription"></i>
      </div>
      <div class="empty-content">
        <h3>No Subscriptions Found</h3>
        <p>Try adjusting your search criteria or create a new subscription plan</p>
        <button class="btn-primary" (click)="createNewPlan()">
          Create First Plan
        </button>
      </div>
    </div>
  </section>

  <!-- Loading State -->
  <ng-template #loadingTemplate>
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <div class="loading-content">
        <h3>Loading Subscription Data</h3>
        <p>Please wait while we load the revenue information...</p>
      </div>
    </div>
  </ng-template>

  <!-- Create Plan Modal -->
  <div *ngIf="showCreatePlanModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Create New Subscription Plan</h3>
        <button class="modal-close" (click)="closeCreatePlanModal()">×</button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Plan Name</label>
          <input type="text" [(ngModel)]="newPlan.name" class="form-input" placeholder="Enter plan name">
        </div>

        <div class="form-group">
          <label class="form-label">Plan Type</label>
          <select [(ngModel)]="newPlan.type" class="form-select">
            <option value="free">Free</option>
            <option value="premium">Premium</option>
            <option value="enterprise">Enterprise</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Price ($)</label>
          <input type="number" [(ngModel)]="newPlan.price" class="form-input" placeholder="0.00" step="0.01">
        </div>

        <div class="form-group">
          <label class="form-label">Billing Interval</label>
          <select [(ngModel)]="newPlan.interval" class="form-select">
            <option value="month">Monthly</option>
            <option value="year">Yearly</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea [(ngModel)]="newPlan.description" class="form-textarea" placeholder="Describe the plan benefits"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Features</label>
          <div class="features-list">
            <div *ngFor="let feature of newPlan.features; let i = index" class="feature-input-group">
              <input type="text" [(ngModel)]="newPlan.features[i]" class="form-input" placeholder="Enter feature">
              <button type="button" class="btn-remove" (click)="removeFeature(i)">×</button>
            </div>
            <button type="button" class="btn-add-feature" (click)="addFeature()">
              + Add Feature
            </button>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeCreatePlanModal()">
          Cancel
        </button>
        <button class="btn-primary" (click)="submitNewPlan()" [disabled]="!newPlan.name">
          Create Plan
        </button>
      </div>
    </div>
  </div>

  <!-- Upgrade Modal -->
  <div *ngIf="showUpgradeModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Upgrade User Plan</h3>
        <button class="modal-close" (click)="closeUpgradeModal()">×</button>
      </div>
      
      <div class="modal-body">
        <div class="upgrade-info">
          <div class="user-details">
            <div class="user-avatar large">
              {{ selectedSubscriptionForUpgrade?.userName?.charAt(0) }}
            </div>
            <div class="user-info">
              <div class="user-name">{{ selectedSubscriptionForUpgrade?.userName }}</div>
              <div class="user-email">{{ selectedSubscriptionForUpgrade?.userEmail }}</div>
            </div>
          </div>

          <div class="upgrade-details">
            <div class="current-plan">
              <span class="plan-label">Current Plan:</span>
              <span class="plan-name">{{ selectedSubscriptionForUpgrade?.planName }}</span>
              <span class="plan-price">${{ selectedSubscriptionForUpgrade?.amount }}/month</span>
            </div>

            <div class="upgrade-arrow">→</div>

            <div class="new-plan">
              <span class="plan-label">New Plan:</span>
              <span class="plan-name">Sleep Pro</span>
              <span class="plan-price">$12.99/month</span>
            </div>
          </div>

          <div class="revenue-impact">
            <h4>Revenue Impact</h4>
            <div class="impact-item">
              <span class="impact-label">Monthly Increase:</span>
              <span class="impact-value positive">+${{ selectedSubscriptionForUpgrade?.amount === 0 ? 12.99 : (12.99 - (selectedSubscriptionForUpgrade?.amount || 0)).toFixed(2) }}</span>
            </div>
            <div class="impact-item">
              <span class="impact-label">Annual Increase:</span>
              <span class="impact-value positive">+${{ selectedSubscriptionForUpgrade?.amount === 0 ? 155.88 : ((12.99 - (selectedSubscriptionForUpgrade?.amount || 0)) * 12).toFixed(2) }}</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeUpgradeModal()">
          Cancel
        </button>
        <button class="btn-primary" (click)="confirmUpgrade()">
          Confirm Upgrade
        </button>
      </div>
    </div>
  </div>
</div>